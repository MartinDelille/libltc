<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>libltc: example_encode.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="libltc.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">libltc
   &#160;<span id="projectnumber">1.0.1</span>
   </div>
   <div id="projectbrief">Linear/Logitudinal Time Code (LTC) Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">example_encode.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * compile with</span></div>
<div class="line"><span class="comment"> *  gcc -o ltc-encoder example_encode.c -lltc -lm</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * from the source-folder this can be compiled after building libltc:</span></div>
<div class="line"><span class="comment"> *  gcc -o ltc-encoder example_encode.c ../src/.libs/libltc.a -lm -I../src</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="ltc_8h.html" title="libltc - en+decode linear timecode">ltc.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* define &quot;USE_LOCAL_BUFFER&quot; to</span></div>
<div class="line"><span class="comment"> * use a local buffer instead of a pointer to</span></div>
<div class="line"><span class="comment"> * libltc&#39;s internal buffer</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment">//#ifdef USE_LOCAL_BUFFER</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {</div>
<div class="line">        FILE* file;</div>
<div class="line">        <span class="keywordtype">double</span> length = 2; <span class="comment">// in seconds</span></div>
<div class="line">        <span class="keywordtype">double</span> fps = 25;</div>
<div class="line">        <span class="keywordtype">double</span> sample_rate = 48000;</div>
<div class="line">        <span class="keywordtype">char</span> *filename;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> vframe_cnt;</div>
<div class="line">        <span class="keywordtype">int</span> vframe_last;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> total = 0;</div>
<div class="line">        <a class="code" href="ltc_8h.html#a1d702f47d78768fd74aabd04b1e47091">ltcsnd_sample_t</a> *buf;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="ltc_8h.html#a3c037295fc56b69e7282427bac3e38c4">LTCEncoder</a> *encoder;</div>
<div class="line">        <a name="_a0"></a><a class="code" href="ltc_8h.html#structSMPTETimecode">SMPTETimecode</a> st;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* start encoding at this timecode */</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> timezone[6] = <span class="stringliteral">&quot;+0100&quot;</span>;</div>
<div class="line">        strcpy(st.<a name="a1"></a><a class="code" href="ltc_8h.html#abf056d6aa0c9046ed39c8b6f4ae568da">timezone</a>, timezone);</div>
<div class="line">        st.<a name="a2"></a><a class="code" href="ltc_8h.html#af4fc85d71e69e87bcfc269c6e4dfcf25" title="LTC-date uses 2-digit year 00.99.">years</a> =  8;</div>
<div class="line">        st.<a name="a3"></a><a class="code" href="ltc_8h.html#a33881ec86a28953e740e4b12195266e8" title="valid months are 1..12">months</a> = 12;</div>
<div class="line">        st.<a name="a4"></a><a class="code" href="ltc_8h.html#aa58d86b05da0fb1aa5f8663fa9c743bc" title="day of month 1..31">days</a> =   31;</div>
<div class="line"></div>
<div class="line">        st.<a name="a5"></a><a class="code" href="ltc_8h.html#a46a49bf0cc03a662959d96145b543bf3" title="hour 0..23">hours</a> = 23;</div>
<div class="line">        st.<a name="a6"></a><a class="code" href="ltc_8h.html#a3a61b5ec33a92b13bc7ce21cb54e55ce" title="minute 0..60">mins</a> = 59;</div>
<div class="line">        st.<a name="a7"></a><a class="code" href="ltc_8h.html#acabc2874dae09c842660cda082cbd7d1" title="second 0..60">secs</a> = 59;</div>
<div class="line">        st.<a name="a8"></a><a class="code" href="ltc_8h.html#a1b22b2e8db1d8d2b526919e0f8cef0ee" title="sub-second frame 0..{FPS-1}">frame</a> = 0;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* parse commandline args */</span></div>
<div class="line">        <span class="keywordflow">if</span> (argc &gt; 1) {</div>
<div class="line">                filename = argv[1];</div>
<div class="line">                <span class="keywordflow">if</span> (argc &gt; 2) {</div>
<div class="line">                        sample_rate = atof(argv[2]);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (argc &gt; 3) {</div>
<div class="line">                        fps = atof(argv[3]);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (argc &gt; 4) {</div>
<div class="line">                        length = atof(argv[4]);</div>
<div class="line">                }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;ltc-encoder - test/example application to encode LTC to a file\n\n&quot;</span>);</div>
<div class="line">                printf(<span class="stringliteral">&quot;Usage: ltc-encoder &lt;filename&gt; [sample rate [frame rate [duration in s]]]\n\n&quot;</span>);</div>
<div class="line">                printf(<span class="stringliteral">&quot;default-values:\n&quot;</span>);</div>
<div class="line">                printf(<span class="stringliteral">&quot; sample rate: 48000.0 [SPS], frame rate: 25.0 [fps], duration: 2.0 [sec]\n&quot;</span>);</div>
<div class="line">                printf(<span class="stringliteral">&quot;Report bugs to Robin Gareus &lt;robin@gareus.org&gt;\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* open output file */</span></div>
<div class="line">        file = fopen(filename, <span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (!file) {</div>
<div class="line">                fprintf(stderr, <span class="stringliteral">&quot;Error: can not open file &#39;%s&#39; for writing.\n&quot;</span>, filename);</div>
<div class="line">                <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* prepare encoder */</span></div>
<div class="line">        encoder = <a name="a9"></a><a class="code" href="ltc_8h.html#afe31d23e55d4af47a2d1e6bc5c1bbff9">ltc_encoder_create</a>(sample_rate, fps, 1);</div>
<div class="line">        <a name="a10"></a><a class="code" href="ltc_8h.html#a3046829f29d125287ec4a5d3316a53f0">ltc_encoder_set_timecode</a>(encoder, &amp;st);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef USE_LOCAL_BUFFER</span></div>
<div class="line"><span class="preprocessor"></span>        buf = calloc(<a name="a11"></a><a class="code" href="ltc_8h.html#a07af03e143b3f2aa76fda8884724dca0">ltc_encoder_get_buffersize</a>(encoder), <span class="keyword">sizeof</span>(<a class="code" href="ltc_8h.html#a1d702f47d78768fd74aabd04b1e47091">ltcsnd_sample_t</a>));</div>
<div class="line">        <span class="keywordflow">if</span> (!buf) {</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="comment">/* ready to go, print some info first */</span></div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;sample rate: %.2f\n&quot;</span>, sample_rate);</div>
<div class="line">        printf(<span class="stringliteral">&quot;frames/sec: %.2f\n&quot;</span>, fps);</div>
<div class="line">        printf(<span class="stringliteral">&quot;secs to write: %.2f\n&quot;</span>, length);</div>
<div class="line">        printf(<span class="stringliteral">&quot;sample format: 8bit unsigned mono\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">        vframe_cnt = 0;</div>
<div class="line">        vframe_last = length * fps;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">while</span> (vframe_cnt++ &lt; vframe_last) {</div>
<div class="line"><span class="preprocessor">#if 1 </span><span class="comment">/* encode and write each of the 80 LTC frame bits (10 bytes) */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordtype">int</span> byte_cnt;</div>
<div class="line">                <span class="keywordflow">for</span> (byte_cnt = 0 ; byte_cnt &lt; 10 ; byte_cnt++) {</div>
<div class="line">                        <a name="a12"></a><a class="code" href="ltc_8h.html#a274bf28daef0c440205478c26e21b5cd">ltc_encoder_encode_byte</a>(encoder, byte_cnt, 1.0);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef USE_LOCAL_BUFFER</span></div>
<div class="line"><span class="preprocessor"></span>                        <span class="keywordtype">int</span> len = <a name="a13"></a><a class="code" href="ltc_8h.html#a1195b10642ea3178d4b4dcfe1e286120">ltc_encoder_get_buffer</a>(encoder, buf);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>                        <span class="keywordtype">int</span> len;</div>
<div class="line">                        buf = <a name="a14"></a><a class="code" href="ltc_8h.html#af9883d72bf2007f45e14aa3e1b61ba1b">ltc_encoder_get_bufptr</a>(encoder, &amp;len, 1);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                        <span class="keywordflow">if</span> (len &gt; 0) {</div>
<div class="line">                                fwrite(buf, <span class="keyword">sizeof</span>(<a class="code" href="ltc_8h.html#a1d702f47d78768fd74aabd04b1e47091">ltcsnd_sample_t</a>), len, file);</div>
<div class="line">                                total+=len;</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* encode a complete LTC frame in one step */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>                <a name="a15"></a><a class="code" href="ltc_8h.html#ad38539cbe0d906fd7abeefda17824702">ltc_encoder_encode_frame</a>(encoder);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef USE_LOCAL_BUFFER</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordtype">int</span> len = <a class="code" href="ltc_8h.html#a1195b10642ea3178d4b4dcfe1e286120">ltc_encoder_get_buffer</a>(encoder, buf);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordtype">int</span> len;</div>
<div class="line">                buf = <a class="code" href="ltc_8h.html#af9883d72bf2007f45e14aa3e1b61ba1b">ltc_encoder_get_bufptr</a>(encoder, &amp;len, 1);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">                <span class="keywordflow">if</span> (len &gt; 0) {</div>
<div class="line">                        fwrite(buf, <span class="keyword">sizeof</span>(<a class="code" href="ltc_8h.html#a1d702f47d78768fd74aabd04b1e47091">ltcsnd_sample_t</a>), len, file);</div>
<div class="line">                        total+=len;</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">                <a name="a16"></a><a class="code" href="ltc_8h.html#a22161fd7d90b513c5ecbbc3ab96cb541">ltc_encoder_inc_timecode</a>(encoder);</div>
<div class="line">        }</div>
<div class="line">        fclose(file);</div>
<div class="line">        <a name="a17"></a><a class="code" href="ltc_8h.html#a116e4b5b95b27e52a522c1001421e345">ltc_encoder_free</a>(encoder);</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;Done: wrote %d samples to &#39;%s&#39;\n&quot;</span>, total, filename);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef USE_LOCAL_BUFFER</span></div>
<div class="line"><span class="preprocessor"></span>        free(buf);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Nov 3 2012 18:21:33 for libltc by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
